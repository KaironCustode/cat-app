# Cat Behavior Analyzer & Horoscope App - Project Summary

## Overview
A Next.js 16 web application that combines AI-powered cat behavior analysis with a mystical horoscope feature. The app uses Grok-4 (xAI) Vision API to analyze cat photos/videos and provides behavioral insights, plus generates personalized astrological horoscopes for cat guardians.

## Core Features

### 1. Cat Behavior Analyzer (`/`)
- **Input**: Users upload photos or videos (max 20 seconds) of their cat
- **Processing**: 
  - Videos are processed client-side using Canvas API to extract frames (2 fps for ≤10s videos, 1 fps for >10s videos, max 20 frames)
  - Frames/images are converted to base64 and sent to Grok-4 Vision API
- **Output**: Detailed behavioral analysis including:
  - Body language interpretation (ears, tail, pupils, posture, facial expression)
  - Emotional state assessment
  - Probable intentions
  - Practical advice for the owner
- **AI Identity**: The AI identifies as "Shenzy", an AI cat that speaks naturally and directly in Italian, without forced empathy or role-playing

### 2. Cat Horoscope (`/horoscope`)
- **Input Form**:
  - Guardian's name (required)
  - Cat's name (required)
  - Birth month (required)
  - Birth year (optional)
  - Fur color (required)
  - Personality trait (optional)
- **Output**: Personalized monthly horoscope generated by Shenzy (the feline oracle)
- **Tone**: Pseudorealistic, traditional astrology style (not obviously satirical, but not presented as absolute truth)
- **Target Audience**: The horoscope is addressed to the guardian, providing advice on how to care for their cat based on astral influences

## Technical Stack

### Frontend
- **Framework**: Next.js 16.0.10
- **Styling**: Tailwind CSS with custom CSS modules
- **Fonts**: Inter (body), Playfair Display (headings) via Google Fonts
- **Design Theme**: 
  - Warm Claude-inspired color palette (terracotta, amber, orange, yellow)
  - Glassmorphism effects
  - Floating paw print animations
  - Gradient backgrounds with animated orbs
  - Modern, premium UI/UX

### Backend
- **API Routes**: Next.js API routes (`/api/cat-analysis`, `/api/cat-horoscope`)
- **AI Models**: 
  - Grok-4 (xAI) via `https://api.x.ai/v1/chat/completions` — vision (and horoscope text)
  - Optional: Claude 3.5 Haiku (Anthropic) for behavior analysis "mouth" when using hybrid pipeline
- **Environment**: `XAI_API_KEY` required; `ANTHROPIC_API_KEY` optional (enables hybrid pipeline)

### Key Components

#### `components/CatAnalyzer.tsx`
- Main behavior analysis interface
- Handles file upload (images/videos)
- Client-side video frame extraction using Canvas API
- Video preview with frame count display
- Loading states with animated paw progress bar
- Results display with markdown rendering (bold/italic support)
- Download analysis and reset functionality

#### `components/CatHoroscope.tsx`
- Horoscope generation form
- Client-side particle animation (paw prints) using `useEffect` to avoid hydration mismatches
- Form validation
- Loading state with visible spinner and text
- Results display with personalized header

#### `app/api/cat-analysis/route.ts`
- Processes FormData with base64-encoded images
- **Two modes** (controlled by `ANTHROPIC_API_KEY`):
  - **Grok-only** (default): Single Grok-4 Vision call; Grok both "sees" and writes the Italian Shenzy-style response.
  - **Hybrid (Grok eyes + Claude mouth)**: (1) Grok-4 receives images and returns a neutral, English-only visual description (ears, tail, pupils, posture, etc.). (2) Claude 3.5 Haiku receives that description plus `cat-behavior-knowledge` and writes the final Italian Shenzy-style analysis. Use this when Grok's prose is too verbose or off-brand; Claude provides the "mouth."
- Uses `lib/cat-behavior-knowledge.ts` in both flows
- Returns `{ analysis, imageCount, isVideo }`

#### `app/api/cat-horoscope/route.ts`
- Processes JSON with guardian/cat information
- Constructs horoscope prompt with strict guidelines:
  - No references to planets (use "astri", "stelle vagabonde" instead)
  - No astrophysics, black holes, galaxies, space travel
  - Traditional astrology terminology only
  - Addresses guardian directly using their name
- Calls Grok-4 API with higher temperature (0.9) for creativity

## Design Philosophy

### Visual Identity
- **Color Palette**: Warm, Claude-inspired tones (amber, terracotta, orange, yellow)
- **Typography**: Elegant serif for headings (Playfair Display), clean sans-serif for body (Inter)
- **Animations**: Subtle, premium micro-interactions
- **Glassmorphism**: Semi-transparent cards with blur effects and gradient borders

### AI Personality (Shenzy)
- **Identity**: AI cat, not a formal veterinarian or expert
- **Language**: Italian only (no English/Italian mixing)
- **Tone**: Natural, direct, cat-like - no forced empathy
- **Style**: Uses markdown bold (`**text**`) for emphasis
- **Length**: Concise (max 300 words for behavior analysis, max 400 for horoscope)

## Important Constraints & Guidelines

### Grok-4 Prompt Engineering
- **No role-playing**: Grok is strict about maintaining its identity, so we provide knowledge as reference rather than asking it to "be" something
- **No forced empathy**: Removed "empatico, caloroso" from prompts as it led to inauthentic responses
- **Natural tone**: Direct instructions to speak "naturalmente, direttamente, senza forzature"
- **Italian only**: Explicit instruction to respond only in Italian

### Horoscope Specifics
- **No planets**: Explicitly forbidden - use "astri", "stelle vagabonde", "corpi celesti"
- **No modern astrophysics**: Only traditional astrology terminology
- **Pseudorealistic**: Not obviously satirical, but not presented as absolute truth
- **Guardian-focused**: Addressed to the guardian, providing advice for caring for their cat

### Video Processing
- **Client-side only**: Uses Canvas API to avoid server-side dependencies (better for Vercel deployment)
- **Frame extraction**: 2 fps for videos ≤10s (max 20 frames), 1 fps for videos >10s (max 20 frames)
- **Max duration**: 20 seconds
- **Validation**: Checks video length before processing

## File Structure
```
cat-app/
├── app/
│   ├── api/
│   │   ├── cat-analysis/
│   │   │   └── route.ts          # Behavior analysis API
│   │   └── cat-horoscope/
│   │       └── route.ts          # Horoscope generation API
│   ├── horoscope/
│   │   └── page.tsx               # Horoscope page route
│   ├── globals.css                # Global styles, animations, color palette
│   ├── layout.tsx                 # Root layout with fonts
│   └── page.tsx                  # Main page (CatAnalyzer)
├── components/
│   ├── CatAnalyzer.tsx           # Main behavior analyzer component
│   └── CatHoroscope.tsx          # Horoscope component
└── lib/
    └── cat-behavior-knowledge.ts  # Feline ethology reference data
```

## Key Implementation Details

### Hydration Safety
- Paw particle animations use `useEffect` to generate random values only on client-side, avoiding hydration mismatches

### Markdown Rendering
- Uses `dangerouslySetInnerHTML` with regex replacements for bold/italic
- Bold: `**text**` → `<strong class="text-amber-400">text</strong>`
- Italic: `*text*` → `<em class="text-amber-300/90">text</em>`
- Line breaks: `\n` → `<br />`

### Error Handling
- User-friendly error messages
- API error logging
- Graceful fallbacks

### Loading States
- Animated paw progress bar for behavior analysis
- Spinner with visible text for horoscope generation
- Contextual loading messages

## Future Considerations
- The app was originally designed for Claude/Haiku but switched to Grok-4 due to Vision API availability
- User preference for Claude's writing style over Grok's verbose responses
- Potential for additional features like analysis history, saved horoscopes, etc.

## Environment Setup
```bash
# Required for cat analysis + horoscope
XAI_API_KEY=your_grok_api_key_here

# Optional: enables "Grok eyes + Claude mouth" for behavior analysis
# When set, Grok describes the cat images; Claude writes the Italian response.
ANTHROPIC_API_KEY=your_anthropic_api_key_here
```

## Running the Project
```bash
npm install
npm run dev
```

## Notes for Other AIs
- This project uses Grok-4 (xAI) for Vision. Optionally, Claude (Anthropic) is used only for *text* in the behavior analyzer: **Grok eyes, Claude mouth**. Grok describes what it sees; Claude turns that into the Shenzy-style Italian response. Not complicated at API level — two sequential calls.
- The AI personality "Shenzy" is carefully crafted to avoid Grok's tendency toward verbose, overly empathetic responses
- The horoscope feature is intentionally pseudorealistic - not obviously fake, but not presented as scientific truth
- All user-facing text is in Italian
- The design emphasizes premium, modern aesthetics suitable for a commercial product
